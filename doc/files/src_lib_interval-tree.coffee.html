<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>src/lib/interval-tree.coffee</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="icon" href="../assets/favicon.ico">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
                <h1><img src="../assets/css/logo.png" title="" width="117" height="52"></h1>
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: </em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
                    <h2 class="off-left">APIs</h2>
                    <div id="api-tabview" class="tabview">
                        <ul class="tabs">
                            <li><a href="#api-classes">Classes</a></li>
                            <li><a href="#api-modules">Modules</a></li>
                        </ul>
                
                        <div id="api-tabview-filter">
                            <input type="search" id="api-filter" placeholder="Type to filter APIs">
                        </div>
                
                        <div id="api-tabview-panel">
                            <ul id="api-classes" class="apis classes">
                                <li><a href="../classes/Interval.html">Interval</a></li>
                                <li><a href="../classes/IntervalTree.html">IntervalTree</a></li>
                                <li><a href="../classes/Node.html">Node</a></li>
                                <li><a href="../classes/Point.html">Point</a></li>
                                <li><a href="../classes/SortedList.html">SortedList</a></li>
                            </ul>
                
                            <ul id="api-modules" class="apis modules">
                                <li><a href="../modules/interval-tree2.html">interval-tree2</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
                    Show:
                    <label for="api-show-inherited">
                        <input type="checkbox" id="api-show-inherited" checked>
                        Inherited
                    </label>
            
                    <label for="api-show-protected">
                        <input type="checkbox" id="api-show-protected">
                        Protected
                    </label>
            
                    <label for="api-show-private">
                        <input type="checkbox" id="api-show-private">
                        Private
                    </label>
                    <label for="api-show-deprecated">
                        <input type="checkbox" id="api-show-deprecated">
                        Deprecated
                    </label>
            
                </div>
            
            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
<h1 class="file-heading">File: src/lib/interval-tree.coffee</h1>

<div class="file">
    <pre class="code prettyprint linenums">

SortedList = require &#x27;./sorted-list&#x27;
Node       = require &#x27;./node&#x27;
Point      = require &#x27;./point&#x27;
Interval   = require &#x27;./interval&#x27;
Util       = require &#x27;./util&#x27;


###*
interval tree

@class IntervalTree
@module interval-tree2
###
class IntervalTree


    ###*
    @constructor
    @param {Number} center center of the root node
    ###
    constructor: (center) -&gt;

        Util.assertNumber center, &#x27;IntervalTree: center&#x27;

        ###*
        center =&gt; node

        @property {Object(Node)} nodesByCenter
        ###
        @nodesByCenter = {}


        ###*
        root node

        @property {Node} root
        ###
        @root = @createNode(center)


        ###*
        interval id =&gt; interval

        @property {Object(Interval)} intervalsById
        ###
        @intervalsById = {}


        ###*
        interval id =&gt; node

        @property {Object(Node)} nodesById
        ###
        @nodesById = {}


        ###*
        sorted list of whole point

        @property {SortedList(Point)} pointTree
        ###
        @pointTree = new SortedList(&#x27;val&#x27;)


        ###*
        unique id candidate of interval without id to be added next time

        @property {Number} idCandidate
        ###
        @idCandidate = 0



    ###*
    add one interval

    @method add
    @public
    @param {Number} start start of the interval to create
    @param {Number} end   end of the interval to create
    @param {String|Number} [id] identifier to distinguish intervals. Automatically defiend when not set.
    @return {Interval}
    ###
    add: (start, end, id) -&gt;

        if @intervalsById[id]?
            throw new Error(&#x27;id &#x27; + id + &#x27; is already registered.&#x27;)

        if not id?
            while @intervalsById[@idCandidate]?
                @idCandidate++
            id = @idCandidate


        Util.assertNumber(start, &#x27;1st argument of IntervalTree#add()&#x27;)
        Util.assertNumber(end, &#x27;2nd argument of IntervalTree#add()&#x27;)

        if start &gt;= end
            Util.assertOrder(start, end, &#x27;start&#x27;, &#x27;end&#x27;)


        interval = new Interval(start, end, id)

        @pointTree.insert new Point(interval.start, id)
        @pointTree.insert new Point(interval.end,   id)

        @intervalsById[id] = interval

        return @insert interval, @root


    ###*
    search intervals
    when only one argument is given, return intervals which contains the value
    when two arguments are given, ...

    @method search
    @public
    @param {Number} val1
    @param {Number} val2
    @return {Array(Interval)} intervals
    ###
    search: (val1, val2) -&gt;

        Util.assertNumber val1, &#x27;1st argument at IntervalTree#search()&#x27;

        if not val2?

            return @pointSearch val1

        else

            Util.assertNumber val2, &#x27;2nd argument at IntervalTree#search()&#x27;
            Util.assertOrder val1, val2, &#x27;1st argument&#x27;, &#x27;2nd argument&#x27;, &#x27;IntervalTree#search()&#x27;

            return @rangeSearch val1, val2


    ###*
    removes an interval of the given id

    @method remove
    @public
    @param {Number|String} id id of the interval to remove
    ###
    remove: (id) -&gt;

        interval = @intervalsById[id]

        return if not interval?

        node = @nodesById[id]

        node.remove(interval)

        delete @nodesById[id]
        delete @intervalsById[id]



    ###*
    search intervals at the given node

    @method pointSearch
    @public
    @param {Number} val
    @param {Node} [node] current node to search. default is this.root
    @return {Array(Interval)}
    ###
    pointSearch: (val, node = @root) -&gt;

        Util.assertNumber(val, &#x27;1st argument of IntervalTree#pointSearch()&#x27;)

        results = []

        if val &lt; node.center

            for interval in node.starts

                break if interval.start &gt; val

                results.push interval

            if node.left?
                return results.concat @pointSearch(val, node.left)

            else
                return results


        if val &gt; node.center

            for interval in node.ends

                break if interval.end &lt; val

                results.push interval

            if node.right?
                return results.concat @pointSearch(val, node.right)

            else
                return results

        # if val is node.center
        return results.concat node.starts.toArray()



    ###*
    returns intervals which covers the given start-end interval

    @method rangeSearch
    @public
    @param {Number} start start of the interval
    @param {Number} end end of the interval
    @return {Array(Interval)}
    ###
    rangeSearch: (start, end) -&gt;

        Util.assertNumber start, &#x27;1st argument at IntervalTree#rangeSearch()&#x27;
        Util.assertNumber end, &#x27;2nd argument at IntervalTree#rangeSearch()&#x27;
        Util.assertOrder start, end, &#x27;1st argument&#x27;, &#x27;2nd argument&#x27;, &#x27;IntervalTree#rangeSearch()&#x27;

        resultsById = {}

        for interval in @pointSearch(start)
            resultsById[interval.id] = interval

        for interval in @pointSearch(end)
            resultsById[interval.id] = interval

        # add intervals whose point is included in the given range
        firstPos = @pointTree.firstPositionOf new Point(start)

        lastPos = @pointTree.lastPositionOf new Point(end)

        if lastPos &gt;= 0

            for point in @pointTree.slice(firstPos, lastPos)

                resultsById[point.id] = @intervalsById[point.id]

        return (interval for id, interval of resultsById)



    ###*
    insert interval to the given node

    @method insert
    @private
    @param {Interval} interval
    @param {Node} node node to insert the interval
    @return {Interval} inserted interval
    ###
    insert: (interval, node) -&gt;

        if interval.end &lt; node.center

            node.left ?= @createNode(interval.end)

            return @insert(interval, node.left)

        if node.center &lt; interval.start

            node.right ?= @createNode(interval.start)

            return @insert(interval, node.right)

        node.insert interval

        @nodesById[interval.id] = node

        return interval



    ###*
    create node by center

    @method createNode
    @private
    @param {Number} center
    @return {Node} node
    ###
    createNode: (center) -&gt;

        node = new Node(center)

        @nodesByCenter[center] = node

        return node


module.exports = IntervalTree

    </pre>
</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
